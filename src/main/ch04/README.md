# 4. 테스트 구축하기

리팩터링을 제대로 하려면 실수를 잡아주는 견고한 테스트 스위트(test suit)가 뒷받침돼야 한다.


## 4.1 자가 테스트 코드의 가치

----

- 개발자는 코드를 작성하는 시간보다 현재 상황을 파악, 설계 고민, 디버깅 등에 시간을 더 할애함
- 버그 수정은 대체로 금방 끝나지만 버그를 잡는 과정에서 다른 버그를 심기도 함
- 그래서 그 새로운 버그를 찾느라 많은 시간을 날림

테스트를 적극적으로 활용하니 버그를 찾기 쉬워졌다.

> 테스트 스위트는 강력한 버그 검출 도구로, 버그를 찾는 데 걸리는 시간을 줄여줌

- 테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전임
- 테스트를 작성하다 보면 원하는 기능을 추가하기 위해 무엇이 필요한지 고민하게 됨
- 구현보다 인터페이스에 집중하게 된다는 장점이 있음

## 4.2 테스트할 샘플 코드

----

## 4.3 첫 번째 테스트

----

1. 테스트에 필요한 데이터와 객체를 뜻하는 픽스처를 설정
2. 픽스처의 속성들을 검증
   - 주어진 초깃값에 기초하여 생산 부족분을 정확히 계산했는지 확인

```
실패해야 할 상황에서는 반드시 실패하게 만들자
```
수많은 테스트를 실행했음에도 실패하는게 없다면 테스트가 내 의도와는 다른 방식으로 코드를 다루는 거 아닌지 불안 

- 각각의 테스트가 실패하는 모습을 최소한 한 번씩은 직접 확인 해봄
- 일시적으로 코드에 오류를 주입하는 방식을 사용

```
자주 테스트하라. 작성 중인 코드는 최소한 몇 분 간격으로 테스트하고, 적어도 하루에 한 번은 전체 테스트를 돌려보자
```

## 4.4 테스트 추가하기

----

- public 메소드를 빠짐없이 테스트하는 방식과는 다름
- **테스트는 위험 요인을 중심으로 작성해야 함!**
- 테스트의 목적은 현재 혹은 향후에 발생하는 버그를 찾는데 있음

```
완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다
```

## 4.5 픽스처 수정하기

----

- 세터는 보통 아주 단순하여 버그가 생길 일이 없음 -> 잘 테스트 하지 않음
- 좀 복잡한 세터는 테스트해볼 필요가 있음
- '설정'한 표준 픽스처를 취해서, 테스트를 '수행'하고 이 픽스처가 일을 기대한 대로 처리햇는지를 '검증'
  - 설정-실행-검증
  - 조건-발생-결과
  - 준비-수행-단언

## 4.6 경계 조건 검사하기

----

- 모든 일이 순조로운 범위 안 테스트 외에 경계 지점을 테스트를 작성하는 것도 좋음
  - 경계를 확인하는 테스트를 작성해보면 프로그램에서 특이 상황을 어떻게 처리하는 게 좋을지 생각해볼 수 있음
- 테스트를 어느 수준까지 해야 할까?
  - 버그 없는 완벽한 프로그램을 만들 수는 없지만 테스트가 프로그래밍 속도를 높여준다는 사실에는 변함이 없음
  - 하지만, 테스트에도 수확 체감 법칙(law of dimnishing returs)이 적용 됨
  - 테스트를 너무 많이 작성하다 보면 의욕이 떨어져 나중에는 작성하지 않게 될 위험도 있음
  - 테스트는 위험한 부분에 집중하는 게 좋음


## 4.7 끝나지 않은 여정

----

- 이 책의 주제는 리팩터링이지만 테스트도 굉장한 중요한 주제
- 리팩터링에 반드시 필요한 토대일 뿐만 아니라, 그 자체로도 프로그래밍에 중요한 역할을 함
  - 테스트 용이성(testability)을 아키텍처 평가 기준으로 활용하는 사례도 많음

```
버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자
```